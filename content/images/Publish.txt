Title Publish a Draft
opt Edit existing
    Browser<->S3: GET Organizer
    Browser<->S3: GET Existing Draft
end
Browser<->S3: GET Composer
note left of Browser
User edits draft
end note
Browser->+λPublish: invoke Publish(Draft)
note right of λPublish
Validation
end note
λPublish->S3: PUT Archetype
S3->>+λPublishScribe: Event: ObjectCreated(Archetype)
opt Remove Draft
    λPublish->S3: DELETE Draft
    Note left of S3
    Delete event
    not subscribed
    end note
    λPublish<->S3: GET DraftsIndex
    λPublish->S3: PUT DraftsIndex
    S3->>λIndexUpdated: Event: ObjectCreated(DraftsIndex)
    Note left of λIndexUpdated
    Ignored
    end note
end
λPublish<->S3: GET ArchetypesIndex
λPublish->S3: PUT ArchetypesIndex
S3->>+λIndexUpdated: Event: ObjectCreated(ArchetypesIndex)
λPublish->-Browser: Success
λPublishScribe<->S3: GET Template
note right of λPublishScribe
Render template
end note
λPublishScribe->-S3: PUT HTML asset
note left of S3
HTML files not subscribed
No event triggered
end note
λIndexUpdated<->S3: GET template(s)
note left of λIndexUpdated
Render index
templates
end note
λIndexUpdated->-S3: PUT HTML indexes, feeds
note left of S3
HTML files not subscribed
No event triggered
end note
